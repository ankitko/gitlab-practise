Some logical changes
Some changes from development branch

